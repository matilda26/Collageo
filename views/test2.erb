<div id="container"></div>
  <script>
    var width = window.innerWidth;
    var height = window.innerHeight;

    function update(activeAnchor) {
        var group = activeAnchor.getParent();

        var topLeft = group.get('.topLeft')[0];
        var topRight = group.get('.topRight')[0];
        var bottomRight = group.get('.bottomRight')[0];
        var bottomLeft = group.get('.bottomLeft')[0];
        var image = group.get('Image')[0];

        var anchorX = activeAnchor.getX();
        var anchorY = activeAnchor.getY();

        // update anchor positions
        switch (activeAnchor.getName()) {
            case 'topLeft':
                topRight.setY(anchorY);
                bottomLeft.setX(anchorX);
                break;
            case 'topRight':
                topLeft.setY(anchorY);
                bottomRight.setX(anchorX);
                break;
            case 'bottomRight':
                bottomLeft.setY(anchorY);
                topRight.setX(anchorX);
                break;
            case 'bottomLeft':
                bottomRight.setY(anchorY);
                topLeft.setX(anchorX);
                break;
        }

        image.position(topLeft.position());

        var width = topRight.getX() - topLeft.getX();
        var height = bottomLeft.getY() - topLeft.getY();
        if(width && height) {
            image.width(width);
            image.height(height);
        }
    }
    function addAnchor(group, x, y, name) {
        var stage = group.getStage();
        var layer = group.getLayer();

        var anchor = new Konva.Circle({
            x: x,
            y: y,
            fill: 'rgba(0,0,0,0)',
            radius:8,
            name: name,
            draggable: true,
            dragOnTop: false
        });

        anchor.on('dragmove', function() {
            update(this);
            layer.draw();
        });
        anchor.on('mousedown touchstart', function() {
            group.setDraggable(false);
            this.moveToTop();
        });
        anchor.on('dragend', function() {
            group.setDraggable(true);
            layer.draw();
        });
        // add hover styling
        anchor.on('mouseover', function() {
            var layer = this.getLayer();
            document.body.style.cursor = 'pointer';
            this.setRadius(8);
            this.fill('#666');
            layer.draw();
        });
        anchor.on('mouseout', function() {
            var layer = this.getLayer();
            document.body.style.cursor = 'default';
            this.setRadius(8);
            this.fill('rgba(0,0,0,0)');
            layer.draw();
        });

        group.add(anchor);
    }

    var stage = new Konva.Stage({
        container: 'container',
        width: width,
        height: height
    });

    var layer = new Konva.Layer();
    stage.add(layer);


    var imgOne = new Konva.Image({
    });
    // layer.add(imgOne);

    var imgTwo = new Konva.Image({
    });
    // layer.add(imgTwo);

    var imgOneGroup = new Konva.Group({
        x: 180,
        y: 50,
        draggable: true
    });
    layer.add(imgOneGroup);
    imgOneGroup.add(imgOne);


    var imgTwoGroup = new Konva.Group({
        x: 20,
        y: 110,
        draggable: true
    });
    layer.add(imgTwoGroup);
    imgTwoGroup.add(imgTwo);


    var imageObj1 = new Image();
    imageObj1.onload = function() {
        imgOne.image(imageObj1);
        layer.draw();
    };
    imageObj1.src = '/images/test_3.jpg';

    var imageObj2 = new Image();
    imageObj2.onload = function() {
        imgTwo.image(imageObj2);
        layer.draw();
    };
    imageObj2.src = '/images/test_4.jpg';

    function addAnchors(img, group) {
      addAnchor(group, 0, 0, 'topLeft');
      addAnchor(group, img.width(), 0, 'topRight');
      addAnchor(group, img.width(), img.height(), 'bottomRight');
      addAnchor(group, 0, img.height(), 'bottomLeft');
    };
    window.addEventListener('load', function(){
      addAnchors(imgOne, imgOneGroup);
      addAnchors(imgTwo, imgTwoGroup)
    });


var rect1 = new Konva.Rect({
  x: 60,
  y: 60,
  width: 100,
  height: 90,
  fill: 'red',
  name: 'rect',
  draggable: true
});
layer.add(rect1);

var rect2 = new Konva.Rect({
  x: 250,
  y: 100,
  width: 150,
  height: 90,
  fill: 'black',
  name: 'rect',
  draggable: true
});
layer.add(rect2);
layer.draw();

stage.on('click', function (e) {
  // if click on empty area - remove all transformers
  if (e.target === stage) {
    stage.find('Transformer').destroy();
    layer.draw();
    return;
  }
  // do nothing if clicked NOT on our rectangles
  if (!e.target.hasName('rect')) {
    return;
  }
  // remove old transformers
  // TODO: we can skip it if current rect is already selected
  stage.find('Transformer').destroy();

  // create new transformer
  var tr = new Konva.Transformer();
  layer.add(tr);
  tr.attachTo(e.target);
  layer.draw();
})


  </script>
